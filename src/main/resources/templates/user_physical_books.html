<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Physical Books</title>

    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

    <style>
        /* ================= BACKGROUND ================= */
        body {
            min-height: 100vh;
            background:
                    linear-gradient(
                            rgba(10,20,40,0.20),
                            rgba(10,20,40,0.20)
                    ),
                    url("https://images.unsplash.com/photo-1507842217343-583bb7270b66");
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            font-family: "Segoe UI", system-ui, sans-serif;
        }

        /* ================= MAIN GLASS CONTAINER ================= */
        .glass-container {
            background: rgba(255,255,255,0.85);
            backdrop-filter: blur(14px);
            border-radius: 24px;
            padding: 30px;
            box-shadow: 0 30px 70px rgba(0,0,0,0.40);
        }

        /* ================= TITLE ================= */
        .page-title {
            font-weight: 800;
            color: #1e40af;
            display: flex;
            align-items: center;
            gap: 10px;
            text-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }

        /* ================= SEARCH & SORT ================= */
        .search-box,
        .sort-box {
            border-radius: 999px;
            box-shadow: 0 6px 18px rgba(0,0,0,0.15);
        }

        /* ================= CATEGORY CARD ================= */
        .cat-box {
            background: rgba(255,255,255,0.65);
            backdrop-filter: blur(12px);
            border-radius: 18px;
            margin-bottom: 20px;
            box-shadow: 0 14px 35px rgba(0,0,0,0.22);
            transition: all .25s ease;
            overflow: hidden;
        }

        .cat-box:hover {
            transform: translateY(-3px);
            box-shadow: 0 22px 50px rgba(0,0,0,0.35);
        }

        /* ================= CATEGORY HEADER ================= */
        .cat-header {
            padding: 18px 22px;
            font-weight: 700;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, #1e3a8a, #2563eb);
            color: #f8fafc;
        }

        .cat-header:hover {
            background: linear-gradient(135deg, #1e40af, #1d4ed8);
        }

        .cat-header i {
            transition: transform .3s ease;
        }

        /* ================= BOOK ROW ================= */
        .book-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 20px;
            border-top: 1px solid rgba(0,0,0,0.08);
        }

        .book-row:hover {
            background: rgba(37,99,235,0.06);
        }

        /* ================= QTY BADGE ================= */
        .qty-badge {
            background: linear-gradient(135deg, #fde68a, #f59e0b);
            padding: 6px 14px;
            border-radius: 999px;
            font-weight: 700;
            color: #1f2937;
        }

        /* ================= DETAILS BUTTON ================= */
        .btn-details {
            background: linear-gradient(135deg, #2563eb, #1e40af);
            color: #f8fafc;
            padding: 7px 18px;
            border-radius: 999px;
            text-decoration: none;
            font-weight: 600;
            transition: all .25s ease;
        }

        .btn-details:hover {
            background: linear-gradient(135deg, #1e40af, #1e3a8a);
            transform: scale(1.05);
            box-shadow: 0 8px 22px rgba(37,99,235,0.45);
            color: #fff;
        }

        /* ================= TOP ACTIONS ================= */
        .top-actions a {
            border-radius: 999px;
            font-weight: 600;
        }
    </style>
</head>

<body>

<div class="container mt-4 mb-5">
    <div class="glass-container">

        <!-- ================= HEADER ================= -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="page-title">üìò Physical Library Books</h2>

            <div class="top-actions d-flex gap-2">
                <a href="/user/books/physical/history" class="btn btn-outline-primary">üìú History</a>
                <a href="/user/home" class="btn btn-outline-secondary">üè† Home</a>
            </div>
        </div>

        <!-- ================= SEARCH ================= -->
        <input id="searchBox"
               class="form-control mb-3 search-box"
               placeholder="Search by title, author or year">

        <!-- ================= SORT ================= -->
        <select id="sortSelect"
                class="form-select w-auto mb-4 sort-box">
            <option value="">Sort books</option>
            <option value="title">Sort by title</option>
            <option value="author">Sort by author</option>
            <option value="year">Sort by year</option>
            <option value="quantity">Sort by quantity</option>
        </select>

        <!-- ================= CATEGORIES ================= -->
        <div th:each="entry,iter : ${groupedBooks}"
             class="cat-box">

            <div class="cat-header"
                 data-bs-toggle="collapse"
                 th:data-bs-target="'#cat' + ${iter.index}">
                <span th:text="${entry.key}">Category</span>
                <i class="bi bi-chevron-down"></i>
            </div>

            <div class="collapse"
                 th:id="'cat' + ${iter.index}">

                <div th:each="b : ${entry.value}"
                     class="book-row search-item">

                    <div>
                        <b th:text="${b.title}">Title</b>
                        ‚Äî
                        <span th:text="${b.author}">Author</span>
                        (<span th:text="${b.year}">Year</span>)
                    </div>

                    <div class="d-flex gap-2 align-items-center">
                        <span class="qty-badge">
                            Qty: <span th:text="${b.quantity}">0</span>
                        </span>

                        <a class="btn-details"
                           th:href="@{'/user/books/physical/details/' + ${b.id}}">
                            Details
                        </a>
                    </div>

                </div>
            </div>
        </div>

    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<!-- ================= JS ‚Äì NEMODIFICAT ================= -->
<script>
    document.getElementById("searchBox").addEventListener("keyup", function () {
        let val = this.value.toLowerCase();
        document.querySelectorAll(".search-item").forEach(row => {
            row.style.display = row.innerText.toLowerCase().includes(val) ? "" : "none";
        });
    });

    document.getElementById("sortSelect").addEventListener("change", function () {
        if (this.value) {
            window.location.href = "/user/books/physical?sort=" + this.value;
        }
    });
</script>

</body>
</html>
