<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Physical Books</title>

    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

    <style>
        body { background:#f4f6fc; }

        .cat-box {
            border-left:4px solid #2563eb;
            background:white;
            border-radius:8px;
            margin-bottom:20px;
        }

        .cat-header {
            padding:15px;
            font-weight:600;
            font-size:18px;
            cursor:pointer;
            display:flex;
            justify-content:space-between;
            align-items:center;
        }

        .book-row {
            display:flex;
            justify-content:space-between;
            padding:10px 15px;
            border-top:1px solid #eee;
        }

        .qty-badge {
            background:goldenrod;
            padding:5px 10px;
            border-radius:6px;
            font-weight:600;
        }

        .btn-details {
            background:#0ea5e9;
            color:white;
            padding:6px 12px;
            border-radius:6px;
            text-decoration:none;
        }

        .top-actions {
            display:flex;
            gap:10px;
            flex-wrap:wrap;
        }
    </style>
</head>

<body>

<div class="container mt-4">

    <!-- HEADER -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="fw-bold text-primary mb-0">Physical Library Books</h2>

        <div class="top-actions">
            <a href="/user/books/physical/history"
               class="btn btn-outline-primary">
                üìú History
            </a>

            <a href="/user/home"
               class="btn btn-outline-secondary">
                üè† Home
            </a>
        </div>
    </div>

    <!-- SEARCH -->
    <input id="searchBox"
           class="form-control mb-3"
           placeholder="Search by title, author or year">

    <!-- SORT -->
    <select id="sortSelect"
            class="form-select w-auto mb-3">
        <option value="">Sort books</option>
        <option value="title">Sort by title</option>
        <option value="author">Sort by author</option>
        <option value="year">Sort by year</option>
        <option value="quantity">Sort by quantity</option>
    </select>

    <!-- CATEGORIES -->
    <div th:each="entry,iter : ${groupedBooks}"
         class="cat-box">

        <div class="cat-header"
             data-bs-toggle="collapse"
             th:data-bs-target="'#cat' + ${iter.index}">
            <span th:text="${entry.key}">Category</span>
            <i class="bi bi-chevron-down"></i>
        </div>

        <div class="collapse"
             th:id="'cat' + ${iter.index}">

            <div th:each="b : ${entry.value}"
                 class="book-row search-item">

                <div>
                    <b th:text="${b.title}">Title</b>
                    -
                    <span th:text="${b.author}">Author</span>
                    (
                    <span th:text="${b.year}">Year</span>
                    )
                </div>

                <div class="d-flex gap-2 align-items-center">
                    <span class="qty-badge">
                        Qty:
                        <span th:text="${b.quantity}">0</span>
                    </span>

                    <a class="btn-details"
                       th:href="@{'/user/books/physical/details/' + ${b.id}}">
                        Details
                    </a>
                </div>

            </div>
        </div>
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
    document.getElementById("searchBox").addEventListener("keyup", function () {
        let val = this.value.toLowerCase();
        document.querySelectorAll(".search-item").forEach(row => {
            row.style.display = row.innerText.toLowerCase().includes(val) ? "" : "none";
        });
    });

    document.getElementById("sortSelect").addEventListener("change", function () {
        if (this.value) {
            window.location.href = "/user/books/physical?sort=" + this.value;
        }
    });
</script>

</body>
</html>
